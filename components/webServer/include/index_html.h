#ifndef INDEX_HTML_H
#define INDEX_HTML_H

const char *htmlContent = "<!DOCTYPE html>\n<html>\n<title>Online HTML Editor</title>\n\n<head>\n</head>\n\n<body>\n    <h1>HTML TEST</h1>\n  <p> <a href=\"/\"><button id=\\\"button1\\\">Current Condition</button></a> <a href=\"/setting\"><button id=\\\"button2\\\">Current Setting</button></a> </p>\n    <p>Data from http server, retrieves every 5 seconds</p>\n    <P id=\"counter\"></P>\n    <script src=\"myscripts.js\"></script>\n</body>\n\n</html>\n";

const char *currentConditionPage = "<!DOCTYPE html>\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <title>Current Conditions</title>\n\n    <link href=\"magnum_style.css\" rel=\"stylesheet\" type=\"text/css\" />\n    <!-- <link rel=\"icon\" type=\"images/favicon\" href=\"res/images/favicon.gif\" /> -->\n  </head>\n  <body\n    style=\"\n      background-color: #ffffff;\n      margin-top: 0px;\n      margin-left: 0px;\n      margin-right: 0px;\n    \"\n  >\n    <div\n      id=\"wrapper\"\n      style=\"\n        width: 100%;\n        margin-left: auto;\n        margin-right: auto;\n        background-color: #ffffff;\n      \"\n    >\n      <div class=\"navBarCon\">\n        <ul\n          style=\"\n            border: none;\n            width: 100%;\n            border-spacing: 0px;\n            list-style-type: none;\n          \"\n        >\n          <li>\n            <a href=\"/\">Current Conditions</a>\n          </li>\n          <!-- <li>\n            <a href=\"currentSettings.html\">Current Settings</a>\n          </li>\n          <li style=\"width: 34%\">\n            <a href=\"historical.html\">Historical Data</a>\n          </li> -->\n        </ul>\n      </div>\n    </div>\n    <div style=\"text-align: center\">\n      <h1 id=\"headline\">Current Conditions</h1>\n      <!--Note: This server will be down for scheduled maintenance from 7PM to 9PM CST today.-->\n\n      <br />\n    </div>\n\n    <script>\n      if (!window.console) {\n        console = { log: function () {} };\n      } //IE doesn't like calls to console if debugger is not open\n    </script>\n\n    <script type=\"text/javascript\" src=\"jquery-1.11.1.min.js\"></script>\n    <script type=\"text/javascript\" src=\"excanvas.min.js\"></script>\n\n    <script type=\"text/javascript\" src=\"jquery.flot.js\"></script>\n    <script type=\"text/javascript\" src=\"jquery.flot.threshold.js\"></script>\n    <script type=\"text/javascript\" src=\"howler.min.js\"></script>\n    <script type=\"text/javascript\" src=\"alarm.js\"></script>\n    <script type=\"text/javascript\" src=\"date.js\"></script>\n    <script type=\"text/javascript\" src=\"magnum.js\"></script>\n    <script type=\"text/javascript\">\n      var seconds = 0;\n      var dec = 1;\n      var hoverSOC = false;\n      var hoverVolts = false;\n      var hoverAmp = false;\n      var lastTime = 0;\n      var nowTimeStamp = 0;\n      var chrgLED = 0;\n      var invLED = 0;\n      var dayKB = 2 * 1000;\n      var isIE = msieversion();\n      var channels;\n      var curTime;\n\n      /* This script kindly provided by Microsoft */\n      function msieversion() {\n        var ua = window.navigator.userAgent;\n        var msie = ua.indexOf(\"MSIE \");\n\n        if (msie > 0)\n          // If Internet Explorer, return version number\n          return parseInt(ua.substring(msie + 5, ua.indexOf(\".\", msie)));\n        // If another browser, return 0\n        else return 0;\n      }\n      /* saves the channel data to an object that can be referenced anywhere */\n      function loadChannelData() {\n        var xhr = new XMLHttpRequest();\n        xhr.onreadystatechange = function () {\n          if (xhr.readyState === XMLHttpRequest.DONE) {\n            if (xhr.status === 200) {\n              dataS = $.parseJSON(xhr.responseText);\n              channels = dataS.data;\n              //Commented out because we don't have logging for now\n              // loadHistory();\n              loadDataCreate();\n            } else {\n              console.error(\"Error:\", xhr.status);\n              noResponse = true;\n              customFaults(null);\n            }\n          }\n        };\n        xhr.open(\"GET\", \"/channel.json\", true);\n        xhr.send();\n      }\n\n      /* headline */\n      function updateHeadline() {\n        //urlHostname = \"http://192.168.10.226/data/hostinfo.json?_=1415809551047\";\n        var xhr = new XMLHttpRequest();\n        xhr.onreadystatechange = function () {\n          if (xhr.readyState === XMLHttpRequest.DONE) {\n            if (xhr.status === 200) {\n              var jsonData = JSON.parse(xhr.responseText); // Parse the JSON response\n              processHostInfo(jsonData, false);\n            } else {\n              console.error(\"Error:\", xhr.status);\n            }\n          }\n        };\n        xhr.open(\"GET\", \"/hostinfo.json\", true);\n        xhr.send();\n      }\n      /* headline */\n      function loadHeadline() {\n        //urlHostname = \"http://192.168.10.226/data/hostinfo.json?_=1415809551047\";\n\n        var xhr = new XMLHttpRequest();\n        xhr.onreadystatechange = function () {\n          if (xhr.readyState === XMLHttpRequest.DONE) {\n            if (xhr.status === 200) {\n              var jsonData = JSON.parse(xhr.responseText); // Parse the JSON response\n              processHostInfo(jsonData, true);\n            } else {\n              console.error(\"Error:\", xhr.status);\n            }\n          }\n        };\n        xhr.open(\"GET\", \"/hostinfo.json\", true);\n        xhr.send();\n      }\n\n      //TODO: maybe modify it so that it only contains the mnt data instead of having everything?\n      function processHostInfo(dataS, create) {\n        $(\"#headline\").html(dataS.hostname + \": Current Conditions\");\n\n        var total = getMemory(\"/mnt/data\", \"total\", dataS.drives);\n        var free = getMemory(\"/mnt/data\", \"avail\", dataS.drives);\n        var used = getMemory(\"/mnt/data\", \"used\", dataS.drives);\n        var daysLeft = total / dayKB;\n\n        if (-1 != total) {\n          addLineMem(\n            \"memTable\",\n            \"Total Space:\",\n            commaSeparateNumber((total / 1000).toFixed(0)) + \" MB\",\n            \"total_space\",\n            create\n          );\n          addLineMem(\n            \"memTable\",\n            \"Free Space:<br>Percent:\",\n            formatMem(free, total),\n            \"free_space\",\n            create\n          );\n          addLineMem(\n            \"memTable\",\n            \"Used Space:<br>Percent:\",\n            formatMem(used, total),\n            \"used_space\",\n            create\n          );\n          addLineMem(\n            \"memTable\",\n            'Days Left:<br><span style=\"font-size: .75em\">approximate</span>',\n            commaSeparateNumber((total / dayKB).toFixed(0)),\n            \"days_left\",\n            create\n          );\n        } else {\n          $(\"#memoryData\").hide();\n        }\n        /* if USB is plugged in */\n        if (-1 != getMemory(\"/media/usb0\", \"total\", dataS.drives)) {\n          $(\".usbRow\").show();\n\n          /* safe to remove? */\n          var readOnly = getMemory(\"/media/usb0\", \"readOnly\", dataS.drives);\n          if (!readOnly) {\n            $(\"#usbMsg\").html(\n              \"File copy in progess<br>DO NOT REMOVE<br>EXTERNAL STORAGE</span>\"\n            );\n            $(\"#usbMsg\").css(\"background-color\", \"red\");\n            $(\"#usbMsg\").css(\"color\", \"white\");\n            MemUp();\n          } else {\n            $(\"#usbMsg\").html(\n              \"File copy is complete.<br>You may safely remove<br>external storage</span>\"\n            );\n            $(\"#usbMsg\").css(\"background-color\", \"green\");\n            $(\"#usbMsg\").css(\"color\", \"white\");\n          }\n        } else {\n          $(\".usbRow\").hide();\n        }\n\n        /* warning if low on space */\n        if (daysLeft <= 30) {\n          $(\"#memWarn\").show();\n        } else {\n          $(\"#memWarn\").hide();\n        }\n      }\n\n      function getMemory(driveName, statName, drives) {\n        for (var i = 0; i < drives.length; i++) {\n          if (-1 != drives[i][\"description\"].indexOf(driveName)) {\n            return drives[i][statName];\n          }\n        }\n        return \"-1\";\n      }\n\n      function formatMem(mem, total) {\n        return (\n          commaSeparateNumber((mem / 1000).toFixed(0)) +\n          \" MB<br>\" +\n          ((mem / total) * 100).toFixed(0) +\n          \"%\"\n        );\n      }\n\n      /* returns oject with channel information */\n      function getChObj(channel) {\n        for (var i = 0; i < channels.length; i++) {\n          if (channels[i].id == channel) return channels[i];\n        }\n        return null;\n      }\n      /* returns the unit of a channel with an option space */\n      function getChUnit(channel, space) {\n        var obj = getChObj(channel);\n        if (null == obj) return \"\";\n        return space + obj.units;\n      }\n\n      var dataAr = [];\n\n      var lastCh = \"\";\n\n      /* loads ten second data */\n      function loadDataCreate() {\n        var xhr = new XMLHttpRequest();\n        xhr.onreadystatechange = function () {\n          if (xhr.readyState === XMLHttpRequest.DONE) {\n            if (xhr.status === 200) {\n              dataS = $.parseJSON(xhr.responseText);\n              loadTime(dataS, true);\n              //   createTable(dataS, true);\n            } else {\n              console.error(\"Error:\", xhr.status);\n              noResponse = true;\n              customFaults(null);\n            }\n          }\n        };\n        xhr.open(\"GET\", \"/dataNow.json\", true);\n        xhr.send();\n      }\n\n      function loadData() {\n        var xhr = new XMLHttpRequest();\n        xhr.onreadystatechange = function () {\n          if (xhr.readyState === XMLHttpRequest.DONE) {\n            if (xhr.status === 200) {\n              dataS = $.parseJSON(xhr.responseText);\n              loadTime(dataS, false);\n              //   createTable(dataS, false);\n            } else {\n              console.error(\"Error:\", xhr.status);\n              noResponse = true;\n              customFaults(null);\n            }\n          }\n        };\n        xhr.open(\"GET\", \"/dataNow.json\", true);\n        xhr.send();\n      }\n\n      /* creates the current table */\n      function createTable(dataNow, create) {\n        $.each(dataNow.data, function (key, value) {\n          dataAr[value.channel] = value;\n          lastCh = value.channel;\n        });\n\n        if (create) $(\"#currentTable\").html(\"\");\n\n        if (dataNow.data.length != 0) {\n          noData = false;\n          noResponse = false;\n          /* Check for faults */\n          customFaults(dataAr);\n\n          /* Data date row */\n          dateRows(dataAr, create);\n\n          /* BMK rows */\n          batteryCharts(dataAr, create);\n          batteryRows(dataAr, create);\n          if (parseInt(dataAr[\"age_bmk\"].sampleValue) < 100) {\n            updatePlotArrays(dataAr, create);\n          } else {\n            $(\"#loadingMsg\").hide();\n          }\n          /* Inverter rows */\n          inverterRows(dataAr, create);\n\n          /* AGS rows */\n          agsRows(dataAr, create);\n\n          /* 24hour data */\n          //dailyStats(dataAr,create);\n          // loadDayData(dataAr,create); //TODO: This is removed for now since we don't have 24 hours data\n\n          /* plot graphs */\n          if (create && parseInt(dataAr[\"age_bmk\"].sampleValue) < 100)\n            plotGraphs();\n\n          /* start page timer */\n          if (create) {\n            location.href = \"#tables\";\n            timerTick();\n          }\n        } else {\n          noData = true;\n          customFaults(null);\n        }\n      }\n\n      function loadTime(dataS, bol) {\n        var xhr = new XMLHttpRequest();\n        xhr.onreadystatechange = function () {\n          if (xhr.readyState === XMLHttpRequest.DONE) {\n            if (xhr.status === 200) {\n              curTime = $.parseJSON(xhr.responseText).data;\n              createTable(dataS, bol);\n            } else {\n              console.error(\"Error:\", xhr.status);\n              noResponse = true;\n              customFaults(null);\n            }\n          }\n        };\n        xhr.open(\"GET\", \"/getTime\", true);\n        xhr.send();\n      }\n\n      /* create the human readable received report */\n      function dateRows(dataAr, create) {\n        addHeader(\"currentTable\", \"Now\", 2, create);\n\n        /* There isn't any kind of age indication in these packets as of now, so we have to remember the last packet time and check against that */\n\n        //FIXME: This is modified to be used in ethernet example\n        console.log(\n          `Current time is ${curTime} and the type is ${typeof curTime}`\n        );\n        curTime = parseInt(curTime);\n        if (255 == parseInt(dataAr[\"age_inverter\"].sampleValue)) {\n          if (lastTime != curTime) {\n            seconds = 0;\n            lastTime = curTime;\n            oldData = false;\n          } else if (seconds > 30) {\n            oldData = true;\n            customFaults(null);\n          }\n        } else {\n          if (lastTime != curTime) {\n            seconds = 0;\n            lastTime = curTime;\n            oldData = false;\n          } else if (seconds > 10) {\n            oldData = true;\n            customFaults(null);\n          }\n        }\n        lastTime = curTime;\n        nowTimeStamp = curTime;\n\n        addLine(\n          \"currentTable\",\n          \"Data Date (UTC):\",\n          '<span id=\"convDate\">' +\n            getUTCTime(curTime) +\n            '</span><br>Report received <span id=\"ageRep\">' +\n            commaSeparateNumber(seconds) +\n            \"</span> seconds ago\",\n          \"date\",\n          create\n        );\n      }\n\n      /* battery monitor charts */\n      function batteryCharts(dataAr, create) {\n        if (parseInt(dataAr[\"age_bmk\"].sampleValue) < 100) {\n          addCat(\n            \"currentTable\",\n            \"Data Supplied By Battery Monitor (ME-BMK)\",\n            create\n          );\n\n          addLine(\n            \"currentTable\",\n            \"Battery Volts:\",\n            dataAr[\"b_dc_volts\"].avg.toFixed(getChObj(\"b_dc_volts\").precision) +\n              \" VDC\",\n            \"b_dc_volts\",\n            create\n          );\n          addLine(\n            \"currentTable\",\n            \"Battery Amps:\",\n            dataAr[\"b_dc_amps\"].avg.toFixed(getChObj(\"b_dc_amps\").precision) +\n              \" amps\",\n            \"b_dc_amps\",\n            create\n          );\n          addLine(\n            \"currentTable\",\n            \"Battery Watts:\",\n            dataAr[\"b_dc_watts\"].avg.toFixed(getChObj(\"b_dc_watts\").precision) +\n              \" watts\",\n            \"b_dc_watts\",\n            create\n          );\n          //addLine(\"currentTable\",'Renewable Watts:<br><span style=\\\"font-size:.75em;\\\">(Approximate Value +/- 50W)</span>',dataAr['calc_add_power'].avg.toFixed(getChObj(\"calc_add_power\").precision)+\" watts\",\"calc_add_power\", create);\n\n          addLine(\n            \"currentTable\",\n            'Battery State of Charge:<br><span style=\"font-size:.75em;\">(10 minute averages over past 24 hours)<br>Gray Bars Indicate Thinking</span>',\n            '<span id=\"battCharge\">Loading...</span><br>' +\n              '<div style=\"width: 100%;height: 70px;padding: 00px 00px 00px 00px;margin-left:auto;margin-right:auto;\">' +\n              '<div id=\"chargeChart\" style=\"width: 100%;height: 100%;font-size: 14px;line-height: 1em;\"  ></div>' +\n              \"</div>\" +\n              '<span id=\"SOCTicks\" style=\"font-size:.8em\"></span>',\n            \"battSOCCell\",\n            create\n          );\n\n          addLine(\n            \"currentTable\",\n            'Battery Watts In/Out:<br><span style=\"font-size:.75em;\">(10 minute averages over past 24 hours)</span>',\n            '<div style=\"width: 100%;height: 70px;padding: 00px 00px 00px 00px;margin-left:auto;margin-right:auto;\">' +\n              '<div id=\"voltsChart\" style=\"width: 100%;height: 100%;font-size: 14px;line-height: 1em;\"  ></div>' +\n              \"</div>\" +\n              '<span id=\"SOCTicks\" style=\"font-size:.8em\"></span>',\n            \"voltsAmpsCell\",\n            create\n          );\n\n          addLine(\n            \"currentTable\",\n            'Battery Amp Hours In / Out:<br><span style=\"font-size:.75em;\">(10 minute averages over past 24 hours)</span>',\n            '<span id=\"ampHours\">Loading...</span><br>' +\n              '<div style=\"width: 100%;height: 70px;padding: 00px 00px 00px 00px;margin-left:auto;margin-right:auto;\">' +\n              '<div id=\"ampChart\" style=\"width: 100%;height: 100%;font-size: 14px;line-height: 1em;\"  ></div>' +\n              \"</div>\" +\n              '<span id=\"SOCTicks\" style=\"font-size:.8em\"></span>',\n            \"ampHoursCell\",\n            create\n          );\n\n          /*\taddLine(\"currentTable\",\"Renewable Watts:<br><span style=\\\"font-size:.75em;\\\">(10 minute averages over past 24 hours)</span>\",\n      \t\t\t\t\"<div style=\\\"width: 100%;height: 70px;padding: 00px 00px 00px 00px;margin-left:auto;margin-right:auto;\\\">\"+\n      \t\t\t\t\t\"<div id=\\\"calcChart\\\" style=\\\"width: 100%;height: 100%;font-size: 14px;line-height: 1em;\\\"  ></div>\"+\n      \t\t\t\t\"</div>\"+\n      \t\t\t\t\"<span id=\\\"SOCTicks\\\" style=\\\"font-size:.8em\\\"></span>\",\"calcCell\", create);\n      \t*/\n\n          if (!create) plotGraphs();\n        }\n      }\n\n      /* battery monitor rows */\n      function batteryRows(dataAr, create) {\n        if (parseInt(dataAr[\"age_bmk\"].sampleValue) < 100) {\n          if (dataAr[\"b_state_of_charge\"].avg <= 100) {\n            $(\"#battCharge\").html(\n              dataAr[\"b_state_of_charge\"].avg.toFixed(0) + \"%\"\n            );\n          } else {\n            $(\"#battCharge\").html(\"Thinking...\");\n          }\n          var watts = Math.round(\n            dataAr[\"b_dc_volts\"].avg * dataAr[\"b_dc_amps\"].avg\n          );\n\n          $(\"#voltsAmps\").html(\n            commaSeparateNumber(\n              dataAr[\"b_dc_volts\"].avg.toFixed(getChObj(\"b_dc_volts\").precision)\n            ) +\n              \" VDC @ \" +\n              commaSeparateNumber(\n                dataAr[\"b_dc_amps\"].avg.toFixed(getChObj(\"b_dc_amps\").precision)\n              ) +\n              \" amps (\" +\n              commaSeparateNumber(watts) +\n              \" watts)\"\n          );\n\n          $(\"#ampHours\").html(\n            commaSeparateNumber(\n              parseFloat(dataAr[\"b_amph_in_out\"].sampleValue).toFixed(\n                getChObj(\"b_amph_in_out\").precision\n              )\n            ) + \" amp hours\"\n          );\n        } else {\n          $(\"#battCharge\").html(\"No Data From BMK. Chart did not update\");\n          $(\"#voltsAmps\").html(\"No Data From BMK. Chart did not update\");\n          $(\"#ampHours\").html(\"No Data From BMK. Chart did not update\");\n        }\n      }\n\n      /* inverter rows */\n      function inverterRows(dataAr, create) {\n        if (parseInt(dataAr[\"age_inverter\"].sampleValue) < 200) {\n          /* Add category header */\n          addCat(\n            \"currentTable\",\n            \"Data Supplied By Inverter (\" +\n              magnumInverterModel(parseInt(dataAr[\"i_model\"].sampleValue), 0) +\n              \")\",\n            create\n          );\n\n          /* Status */\n          addLine(\n            \"currentTable\",\n            \"Status:\",\n            magnumInverterStatus(parseInt(dataAr[\"i_status\"].sampleValue)),\n            \"iStatus\",\n            create\n          );\n\n          addLine(\n            \"currentTable\",\n            \"Battery Temperature:\",\n            magnumTemperature(dataAr[\"i_temp_battery\"].avg),\n            \"batTemp\",\n            create\n          );\n          addLine(\n            \"currentTable\",\n            \"Transformer Temperature:\",\n            magnumTemperature(dataAr[\"i_temp_transformer\"].avg),\n            \"i_tempTransformer\",\n            create\n          );\n          addLine(\n            \"currentTable\",\n            \"FET Temperature:\",\n            magnumTemperature(dataAr[\"i_temp_fet\"].avg),\n            \"i_tempFet\",\n            create\n          );\n\n          /* AC output voltage is displayed if appropriate length even if export\n      \t\tno AC current if export */\n\n          var displayMeters = false;\n          if (\n            (null == dataAr[\"length_inverter\"] ||\n              parseInt(dataAr[\"length_inverter\"].sampleValue) >= 20) &&\n            magnumInverterModel(parseInt(dataAr[\"i_model\"].sampleValue), 3) != 1\n          ) {\n            displayMeters = true;\n          }\n\n          var exportMeters = false;\n          var vacScale = 1.0;\n          if (\n            !displayMeters &&\n            parseInt(dataAr[\"length_inverter\"].sampleValue) >= 20\n          ) {\n            exportMeters = true;\n\n            if (\n              1 ==\n              magnumInverterModel(parseInt(dataAr[\"i_model\"].sampleValue), 3)\n            ) {\n              vacScale = 2.0;\n            }\n\n            /* AC out */\n            var s;\n            if (dataAr[\"i_ac_volts_out\"].avg >= 80) {\n              s =\n                magnumExportVoltageScale(\n                  dataAr[\"i_ac_volts_out\"].avg,\n                  vacScale\n                ).toFixed(getChObj(\"i_ac_volts_out\").precision) + \" volts AC\";\n            } else {\n              s = \"Inactive.\";\n            }\n            addLine(\"currentTable\", \"AC Out:\", s, \"i_acOut\", create);\n          }\n\n          if (displayMeters) {\n            /*\n      \t\t\t//dataAr[\"i_amps_out\"].avg = 123;\n\n      \t\t\tif ( parseFloat(dataAr[\"r_revision\"].sampleValue) < 4 ) {\n      \t\t\t\tif ( dataAr[\"i_amps_out\"].avg >= 0 ){\n      \t\t\t\t\tdataAr[\"i_amps_out\"].avg = 128-dataAr[\"i_amps_out\"].avg;\n      \t\t\t\t}\n      \t\t\t}\n      \t\t\t*/\n\n            /* AC out */\n            var s;\n            if (dataAr[\"i_ac_volts_out\"].avg >= 80) {\n              s =\n                \"Approximately \" +\n                magnumExportVoltageScale(\n                  dataAr[\"i_ac_volts_out\"].avg,\n                  vacScale\n                ).toFixed(getChObj(\"i_ac_volts_out\").precision) +\n                \" volts\";\n              addLine(\n                \"currentTable\",\n                \"AC Out Volts:\",\n                s,\n                \"ac_out_volts\",\n                create\n              );\n              if (\n                1 ==\n                magnumInverterModel(parseInt(dataAr[\"i_model\"].sampleValue), 4)\n              ) {\n                s =\n                  \"Approximately \" +\n                  dataAr[\"i_amps_out\"].avg.toFixed(\n                    getChObj(\"i_amps_out\").precision\n                  ) +\n                  \" amps\";\n                addLine(\n                  \"currentTable\",\n                  \"AC Out Amps:\",\n                  s,\n                  \"ac_out_amps\",\n                  create\n                );\n                addLine(\n                  \"currentTable\",\n                  \"AC Out Watts:\",\n                  \"Approximately \" +\n                    (\n                      dataAr[\"i_ac_volts_out\"].avg * dataAr[\"i_amps_out\"].avg\n                    ).toFixed(0) +\n                    \" watts\",\n                  \"ac_out_watts\",\n                  create\n                );\n              }\n\n              //addLine(\"currentTable\",'AC Out Volts:',s,\"ac_out_volts\", create );\n              //addLine(\"currentTable\",'AC Out Amps:',s , \"ac_out_amps\", create );\n              //addLine(\"currentTable\",'AC Out Watts:',(dataAr[\"i_ac_volts_out\"].avg*dataAr[\"i_amps_out\"].avg).toFixed(0) ,\"ac_out_watts\", create );\n            } else {\n              s = \"Inactive.\";\n              addLine(\n                \"currentTable\",\n                \"AC Out Volts:\",\n                s,\n                \"ac_out_volts\",\n                create\n              );\n              addLine(\"currentTable\", \"AC Out Amps:\", s, \"ac_out_amps\", create);\n              addLine(\n                \"currentTable\",\n                \"AC Out Watts:\",\n                s,\n                \"ac_out_watts\",\n                create\n              );\n            }\n            //addLine(\"currentTable\",'AC Out:',s,\"i_acOut\", create);\n\n            /* AC in */\n            if (\n              dataAr[\"i_ac_volts_in\"].avg >= 80 &&\n              1 ==\n                magnumInverterModel(parseInt(dataAr[\"i_model\"].sampleValue), 4)\n            ) {\n              s =\n                \"Approximately \" +\n                dataAr[\"i_ac_volts_in\"].avg.toFixed(\n                  getChObj(\"i_ac_volts_in\").precision\n                ) +\n                \" volts\";\n              addLine(\"currentTable\", \"AC In Volts:\", s, \"ac_in_volts\", create);\n              addLine(\n                \"currentTable\",\n                \"AC In Amps:\",\n                \"Approximately \" +\n                  dataAr[\"i_amps_in\"].avg.toFixed(\n                    getChObj(\"i_amps_in\").precision\n                  ),\n                \"ac_in_amps\",\n                create\n              );\n              addLine(\n                \"currentTable\",\n                \"AC In Watts:\",\n                \"Approximately \" +\n                  (\n                    dataAr[\"i_amps_in\"].avg * dataAr[\"i_ac_volts_in\"].avg\n                  ).toFixed(0),\n                \"ac_in_watts\",\n                create\n              );\n              //console.log(\"dfd\");\n              $(\"#row_ac_in_amps\").show();\n              $(\"#row_ac_in_watts\").show();\n            } else {\n              s = \"Inactive.\";\n              addLine(\"currentTable\", \"AC In Volts:\", s, \"ac_in_volts\", create);\n              addLine(\"currentTable\", \"AC In Amps:\", s, \"ac_in_amps\", create);\n              addLine(\"currentTable\", \"AC In Watts:\", s, \"ac_in_watts\", create);\n              $(\"#row_ac_in_amps\").hide();\n              $(\"#row_ac_in_watts\").hide();\n            }\n\n            //addLine(\"currentTable\",'AC In:',s,\"i_acIn\", create);\n\n            /* AC frequency */\n            addLine(\n              \"currentTable\",\n              'AC Frequency: <span style=\"font-size: 0.8em;\">(Hz)</span>',\n              dataAr[\"i_ac_hz\"].avg.toFixed(getChObj(\"i_ac_hz\").precision),\n              \"i_acFreq\",\n              create\n            );\n\n            /* DC volts / amps */\n            if (\n              parseInt(dataAr[\"age_bmk\"].sampleValue > 250) ||\n              \"1\" != dataAr[\"b_fault\"].sample\n            ) {\n              //echo magnumGetSparkHTML($station_id,'i_watts',$hours);\n              //echo \"<br>\";\n            }\n            s =\n              dataAr[\"i_dc_volts\"].avg.toFixed(\n                getChObj(\"i_dc_volts\").precision\n              ) +\n              \" VDC @ \" +\n              dataAr[\"i_dc_amps\"].avg.toFixed(getChObj(\"i_dc_amps\").precision) +\n              \" amps (\" +\n              (dataAr[\"i_dc_volts\"].avg * dataAr[\"i_dc_amps\"].avg).toFixed(0) +\n              \" watts)\";\n            addLine(\n              \"currentTable\",\n              'DC volts / amps:<br><span style=\"font-size: 0.8em;\">(Values are approximate)</span>',\n              s,\n              \"i_dcVoltsAmps\",\n              create\n            );\n          }\n        }\n      }\n\n      /* ags rows */\n      function agsRows(dataAr, create) {\n        if (parseInt(dataAr[\"age_ags_0xA1\"].sampleValue) < 100) {\n          addCat(\"currentTable\", \"AGS / Generator\", create);\n\n          addLine(\n            \"currentTable\",\n            \"Status:\",\n            magnumAGSStatus(parseInt(dataAr[\"a_status\"].sampleValue)),\n            \"ags_status\",\n            create\n          );\n          addLine(\n            \"currentTable\",\n            \"AGS Temperature:\",\n            magnumAGSTemperature(dataAr[\"a_temperature\"].avg),\n            \"ags_temp\",\n            create\n          );\n          addLine(\n            \"currentTable\",\n            \"AGS Voltage:\",\n            dataAr[\"a_voltage\"].avg.toFixed(getChObj(\"a_voltage\").precision) +\n              \" VDC\",\n            \"ags_volt\",\n            create\n          );\n\n          addLine(\n            \"currentTable\",\n            'Generator Runtime:<br><span style=\"font-size: 0.8em;\">(Current Cycle)</span>',\n            parseFloat(dataAr[\"a_gen_runtime_minutes\"].sampleValue).toFixed(1) +\n              \" hours\",\n            \"ags_genRun\",\n            create\n          );\n\n          addLine(\n            \"currentTable\",\n            \"Days Since Last Run:\",\n            parseInt(dataAr[\"a_days_since_last\"].sampleValue) + \" days\",\n            \"ags_daysSince\",\n            create\n          );\n\n          addLine(\n            \"currentTable\",\n            'Total Generator Runtime:<br><span style=\"font-size: 0.8em;\"> (Since AGS Boot)</span>',\n            parseInt(dataAr[\"a_gen_run_hours_since_boot\"].sampleValue) +\n              \" hours\",\n            \"ags_genRunHours\",\n            create\n          );\n        } else {\n          addCat(\"currentTable\", \"AGS / Generator\", false);\n\n          addLine(\"currentTable\", \"Status:\", \"No Data\", \"ags_status\", false);\n          addLine(\n            \"currentTable\",\n            \"AGS Temperature:\",\n            \"No Data\",\n            \"ags_temp\",\n            false\n          );\n          addLine(\"currentTable\", \"AGS Voltage:\", \"No Data\", \"ags_volt\", false);\n          addLine(\n            \"currentTable\",\n            'Generator Runtime:<br><span style=\"font-size: 0.8em;\">(Current Cycle)</span>',\n            \"No Data\",\n            \"ags_genRun\",\n            false\n          );\n          addLine(\n            \"currentTable\",\n            \"Days Since Last Run:\",\n            \"No Data\",\n            \"ags_daysSince\",\n            false\n          );\n          addLine(\n            \"currentTable\",\n            'Total Generator Runtime:<br><span style=\"font-size: 0.8em;\"> (Since AGS Boot)</span>',\n            \"No Data\",\n            \"ags_genRunHours\",\n            false\n          );\n        }\n      }\n\n      /* appends row to the given tableID */\n      function addLine(tableID, name, val, id, create) {\n        tableID = \"#\" + tableID;\n\n        if (create) {\n          $(tableID).append(\n            '<tr id=\"row_' +\n              id +\n              '\"><th class=\"right\">' +\n              name +\n              '</th><td id=\"' +\n              id +\n              '\">' +\n              val +\n              \"</td></tr>\"\n          );\n        } else {\n          $(\"#\" + id).html(val);\n        }\n      }\n      /* appends a row to the memory table. The difference is the th class. */\n      function addLineMem(tableID, name, val, id, create) {\n        tableID = \"#\" + tableID;\n\n        if (create) {\n          $(tableID).append(\n            '<tr><th class=\"rightMem\">' +\n              name +\n              '</th><td id=\"' +\n              id +\n              '\">' +\n              val +\n              \"</td></tr>\"\n          );\n        } else {\n          $(\"#\" + id).html(val);\n        }\n      }\n\n      /* appends header to the given tableID */\n      function addHeader(tableID, title, rows, create) {\n        tableID = \"#\" + tableID;\n        if (create)\n          $(tableID).append(\n            '<tr><th colspan=\"' +\n              rows +\n              '\" style=\"font-size: 1.5em;\">' +\n              title +\n              \"</th></tr>\"\n          );\n      }\n\n      /* appends category label to the given tableID */\n      function addCat(tableID, title, create) {\n        tableID = \"#\" + tableID;\n        if (create)\n          $(tableID).append(\n            '<tr><th class=\"table_header\" colspan=\"2\">' + title + \"</th></tr>\"\n          );\n      }\n\n      function addHourCat(tableID, title, create) {\n        tableID = \"#\" + tableID;\n        if (create) {\n          $(tableID).append(\n            '<tr><th class=\"table_header\" colspan=\"4\">' +\n              title +\n              '<span id=\"inverterModel\"></span></th></tr>'\n          );\n          $(tableID).append(\n            \"<tr><th></th>\" +\n              \"<th>Minimum</th>\" +\n              \"<th>Maximum</th>\" +\n              \"<th>Average</th></tr>\"\n          );\n        }\n      }\n\n      function updatePlotArrays(dataAr) {\n        /* push new data into chart arrays */\n        /* if isn't null and the time on the packet does not equal the time of the last pushed element */\n\n        if (data.b_state_array.length != 0) {\n          if (\n            null != dataAr[\"b_state_of_charge\"].avg &&\n            dataAr[\"b_state_of_charge\"].time !=\n              data.b_state_array[data.b_state_array.length - 1][0]\n          ) {\n            data.b_state_array.push([\n              dataAr[\"b_state_of_charge\"].time,\n              dataAr[\"b_state_of_charge\"].avg,\n            ]);\n          }\n          while (data.b_state_array[0][0] < dayAgo) {\n            data.b_state_array.shift();\n          }\n        }\n        if (data.b_watts.length != 0) {\n          if (\n            null != dataAr[\"b_dc_watts\"].avg &&\n            dataAr[\"b_dc_watts\"].time !=\n              data.b_watts[data.b_watts.length - 1][0]\n          ) {\n            data.b_watts.push([\n              dataAr[\"b_dc_watts\"].time,\n              dataAr[\"b_dc_watts\"].avg,\n            ]);\n          }\n          while (data.b_watts[0][0] < dayAgo) {\n            data.b_watts.shift();\n          }\n        }\n        if (data.amp_in_out.length != 0) {\n          if (\n            null != dataAr[\"b_amph_in_out\"].sampleValue &&\n            dataAr[\"b_amph_in_out\"].time !=\n              data.amp_in_out[data.amp_in_out.length - 1][0]\n          ) {\n            data.amp_in_out.push([\n              dataAr[\"b_amph_in_out\"].time,\n              dataAr[\"b_amph_in_out\"].sampleValue,\n            ]);\n          }\n          while (data.amp_in_out[0][0] < dayAgo) {\n            data.amp_in_out.shift();\n          }\n        }\n        if (data.calc.length != 0) {\n          if (\n            null != dataAr[\"calc_add_power\"].avg &&\n            dataAr[\"calc_add_power\"].time != data.calc[data.calc.length - 1][0]\n          ) {\n            data.calc.push([\n              dataAr[\"calc_add_power\"].time,\n              dataAr[\"calc_add_power\"].avg,\n            ]);\n          }\n          while (data.calc[0][0] < dayAgo) {\n            data.calc.shift();\n          }\n        }\n        /* if array has more than 24 hours of data, shift data out */\n\n        var dayAgo = new Date().getTime() - 1000 * 60 * 60 * 24;\n      }\n\n      var battArray = [];\n      var voltsArray = [];\n      var ampArray = [];\n      var calcArray = [];\n      /* this data object will hold the arrays to be used in the charts. This is done to reuse the code from magnum-dev with minimal pain */\n      var data = {\n        b_state_array: [],\n        b_watts: [],\n        amp_in_out: [],\n        calc: [],\n      };\n\n      function loadDayData(dataAr, create) {\n        // If internet explorer, use Microsoft XDR\n        if (isIE) {\n          var xdr = new XDomainRequest();\n          xdr.open(\"get\", urlDay + \"?t=\" + new Date().getTime());\n\n          xdr.onerror = function () {\n            noResponse = true;\n            customFaults(null);\n          };\n          xdr.onload = function () {\n            dataS = $.parseJSON(xdr.responseText);\n\n            processDayData(dataS, dataAr, create);\n          };\n          xdr.send();\n        } else {\n          /* if not IE we use ajax */\n\n          $.ajaxSetup({ cache: false });\n          $.ajax({\n            type: \"GET\",\n            url: urlDay,\n            dataType: \"html\",\n            crossDomain: true,\n          }).done(function (dataS) {\n            dataS = $.parseJSON(dataS);\n            processDayData(dataS, dataAr, create);\n          });\n        }\n      }\n\n      function processDayData(dayData, dataAr, create) {\n        if (create) $(\"#hourTable\").html(\"\");\n\n        addHeader(\"hourTable\", \"24 Hour Data\", 4, create);\n\n        batteryHourRows(dayData, dataAr, create);\n        inverterHourRows(dayData, dataAr, create);\n        agsHourRows(dayData, dataAr, create);\n      }\n\n      function batteryHourRows(dayData, dataAr, create) {\n        if (parseInt(dataAr[\"age_bmk\"].sampleValue) < 100) {\n          addHourCat(\n            \"hourTable\",\n            \"Data Supplied By Battery Monitor (ME-BMK)\",\n            create\n          );\n\n          /* State Of Charge */\n          addHourLineSpec(\n            \"hourTable\",\n            \"b_state_of_charge_clean\",\n            \"Battery State of Charge:\",\n            dayData.dayStats,\n            create\n          );\n\n          /* DC Volts */\n          addHourLine(\n            \"hourTable\",\n            \"b_dc_volts_clean\",\n            \"Battery Volts:\",\n            dayData.dayStats,\n            create\n          );\n\n          /* DC Amps */\n          addHourLine(\n            \"hourTable\",\n            \"b_dc_amps_clean\",\n            \"Battery Amps:\",\n            dayData.dayStats,\n            create\n          );\n\n          /* DC Watts */\n          addHourLine(\n            \"hourTable\",\n            \"b_dc_watts\",\n            \"Battery Watts:\",\n            dayData.dayStats,\n            create\n          );\n\n          /* Calculated Renewable Power */\n          //addHourLine(\"hourTable\",\"calc_add_power\",\"Renewable Watts:\",dayData.dayStats,create );\n\n          //updateHourWatts(\"b_dc_watts\",\"DC Watts:\", create);\n          //updateHourWatts(\"hourTable\",\"b_dc_watts\",\"DC Watts:\", dayData.dayStats,create);\n        }\n      }\n\n      function inverterHourRows(dayData, dataAr, create) {\n        if (parseInt(dataAr[\"age_inverter\"].sampleValue) < 250) {\n          addHourCat(\n            \"hourTable\",\n            \"Data Supplied By Inverter (\" +\n              magnumInverterModel(parseInt(dataAr[\"i_model\"].sampleValue), 0) +\n              \")\",\n            create\n          );\n          /* if no BMK, then show inverter dc volts and amps */\n          if (parseInt(dataAr[\"age_bmk\"].sampleValue) > 250) {\n            /* unfortunately, we aren't keeping track of this in the history json  */\n\n            addHourLine(\n              \"hourTable\",\n              \"i_dc_volts\",\n              \"DC Volts:\",\n              dayData.dayStats,\n              create\n            );\n            addHourLine(\n              \"hourTable\",\n              \"i_dc_amps\",\n              \"DC Amps:\",\n              dayData.dayStats,\n              create\n            );\n          }\n          var displayMeters = false;\n          if (\n            (null == dataAr[\"length_inverter\"] ||\n              parseInt(dataAr[\"length_inverter\"].sampleValue) >= 20) &&\n            magnumInverterModel(parseInt(dataAr[\"i_model\"].sampleValue), 3) != 1\n          ) {\n            displayMeters = true;\n          }\n          var exportMeters = false;\n\n          if (\n            !displayMeters &&\n            parseInt(dataAr[\"length_inverter\"].sampleValue) >= 20\n          ) {\n            exportMeters = true;\n          }\n          if (displayMeters || exportMeters) {\n            /* AC Volts Out ( when volts > 80 ) */\n\n            addHourLine(\n              \"hourTable\",\n              \"i_ac_volts_out_over_80\",\n              'AC volts Out:<br><span style=\"font-size: 0.8em;\">(when volts &gt; 80)</span>',\n              dayData.dayStats,\n              create\n            );\n          }\n          if (displayMeters) {\n            /* if we see a null for i_amps_out, then inverter does not have meters */\n\n            addHourLine(\n              \"hourTable\",\n              \"i_amps_out_inverting\",\n              'AC amps Out:<br><span style=\"font-size: 0.8em;\">(when not charging)</span>',\n              dayData.dayStats,\n              create\n            );\n\n            addHourLine(\n              \"hourTable\",\n              \"i_amps_out_charging\",\n              'AC amps Out:<br><span style=\"font-size: 0.8em;\">(when charging)</span>',\n              dayData.dayStats,\n              create\n            );\n\n            addHourLine(\n              \"hourTable\",\n              \"i_amps_in_clean\",\n              \"AC amps In:\",\n              dayData.dayStats,\n              create\n            );\n\n            addHourLine(\n              \"hourTable\",\n              \"i_ac_hz_clean\",\n              'AC Frequency: <span style=\"font-size: 0.8em;\">(Hz)</span>',\n              dayData.dayStats,\n              create\n            );\n          }\n\n          /* temperatures */\n\n          updateHourRowTemp(\n            \"hourTable\",\n            \"i_temp_battery_clean\",\n            \"Battery Temperature:\",\n            dayData.dayStats,\n            create\n          );\n          updateHourRowTemp(\n            \"hourTable\",\n            \"i_temp_transformer_clean\",\n            \"Transformer Temperature:\",\n            dayData.dayStats,\n            create\n          );\n          updateHourRowTemp(\n            \"hourTable\",\n            \"i_temp_fet_clean\",\n            \"FET Temperature:\",\n            dayData.dayStats,\n            create\n          );\n        }\n      }\n\n      /* 24 hour AGS data */\n      function agsHourRows(dayData, dataAr, create) {\n        if (parseFloat(dataAr[\"age_ags_0xA1\"].sampleValue) < 250) {\n          if (\"0\" == dataAr[\"a_status\"].sampleValue) {\n            addHourCat(\"hourTable\", \"AGS<br>(currently offline)\", create);\n          } else {\n            addHourCat(\"hourTable\", \"AGS\", create);\n          }\n          updateHourRowTempAGS(\n            \"hourTable\",\n            \"a_temperature_clean\",\n            \"AGS Temperature:\",\n            dayData.dayStats,\n            create\n          );\n          addHourLine(\n            \"hourTable\",\n            \"a_voltage_clean\",\n            'AGS Voltage: <span style=\"font-size: 0.8em;\">(volts DC)</span>',\n            dayData.dayStats,\n            create\n          );\n        }\n      }\n\n      function updateHourRowTemp(tableID, id, title, val, create) {\n        var obj = getChObj(id);\n        var prec = 2;\n\n        if (null != obj) {\n          prec = obj.precision;\n        }\n        var unit = getChUnit(id, \"\");\n        if (null == prec) prec = 1;\n\n        if (null != val[id].avg) {\n          if (create) {\n            $(\"#hourTable\").append(\n              '<tr><th class=\"right\">' +\n                title +\n                \"</th>\" +\n                '<td id=\"' +\n                id +\n                '_min\">' +\n                magnumTemperature(val[id].min) +\n                \"</td>\" +\n                '<td id=\"' +\n                id +\n                '_max\">' +\n                magnumTemperature(val[id].max) +\n                \"</td>\" +\n                '<td id=\"' +\n                id +\n                '_avg\">' +\n                magnumTemperature(val[id].avg) +\n                \"</td></tr>\"\n            );\n          } else {\n            $(\"#\" + id + \"_min\").html(magnumTemperature(val[id].min));\n            $(\"#\" + id + \"_max\").html(magnumTemperature(val[id].max));\n            $(\"#\" + id + \"_avg\").html(magnumTemperature(val[id].avg));\n          }\n        }\n      }\n\n      function updateHourRowTempAGS(tableID, id, title, val, create) {\n        var obj = getChObj(id);\n        var prec = 2;\n\n        if (null != obj) {\n          prec = obj.precision;\n        }\n        var unit = getChUnit(id, \"\");\n        if (null == prec) prec = 1;\n\n        if (250 < val[id].max || 0 == val[id].min) {\n          if (create) {\n            $(\"#\" + tableID).append(\n              '<tr id=\"hour_' +\n                id +\n                '\">' +\n                '<th class=\"right\">' +\n                title +\n                \"</th>\" +\n                '<td colspan = \"3\"><i>Was Disconnected...</i></td></tr>'\n            );\n          } else {\n            $(\"#hour_\" + id).html(\n              '<th class=\"right\">' +\n                title +\n                \"</th>\" +\n                '<td colspan = \"3\"><i>Was Disconnected...</i></td>'\n            );\n          }\n\n          return;\n        } else {\n          if (create) {\n            $(\"#hourTable\").append(\n              '<tr><th class=\"right\">' +\n                title +\n                \"</th>\" +\n                '<td id=\"' +\n                id +\n                '_min\">' +\n                magnumAGSTemperature(val[id].min) +\n                \"</td>\" +\n                '<td id=\"' +\n                id +\n                '_max\">' +\n                magnumAGSTemperature(val[id].max) +\n                \"</td>\" +\n                '<td id=\"' +\n                id +\n                '_avg\">' +\n                magnumAGSTemperature(val[id].avg) +\n                \"</td></tr>\"\n            );\n          } else {\n            $(\"#\" + id + \"_min\").html(magnumAGSTemperature(val[id].min));\n            $(\"#\" + id + \"_max\").html(magnumAGSTemperature(val[id].max));\n            $(\"#\" + id + \"_avg\").html(magnumAGSTemperature(val[id].avg));\n          }\n        }\n      }\n\n      function addHourLineSpec(tableID, id, title, val, create) {\n        var chObj = getChObj(id);\n\n        /* if channel exists */\n        if (null != chObj && null != val[id]) {\n          var unit = getChUnit(id, \"\");\n          /* if max is 5e-324 then that means we don't have data for that channel, which is not an error, it just means the inverter doesn't have a feature that others might have */\n          if (val[id].max != 5e-324) {\n            var prec = chObj.precision;\n\n            if (\"b_state_of_charge\" == id && 100 < val[id].max) {\n              if (create) {\n                $(\"#\" + tableID).append(\n                  '<tr id=\"hour_' +\n                    id +\n                    '\">' +\n                    '<th class=\"right\">' +\n                    title +\n                    \"</th>\" +\n                    '<td colspan = \"3\"><i>BMK Was Thinking...</i></td></tr>'\n                );\n              } else {\n                $(\"#hour_\" + id).html(\n                  '<th class=\"right\">' +\n                    title +\n                    \"</th>\" +\n                    '<td colspan = \"3\"><i>BMK Was Thinking...</i></td>'\n                );\n              }\n\n              return;\n            }\n            if (250 < val[id].max) {\n              if (create) {\n                $(\"#\" + tableID).append(\n                  '<tr id=\"hour_' +\n                    id +\n                    '\">' +\n                    '<th class=\"right\">' +\n                    title +\n                    \"</th>\" +\n                    '<td colspan = \"3\"><i>Was Disconnected...</i></td></tr>'\n                );\n              } else {\n                $(\"#hour_\" + id).html(\n                  '<th class=\"right\">' +\n                    title +\n                    \"</th>\" +\n                    '<td colspan = \"3\"><i>Was Disconnected...</i></td>'\n                );\n              }\n              return;\n            }\n            addHourLine(tableID, id, title, val, create);\n          }\n        }\n      }\n\n      function addHourLine(tableID, id, title, val, create) {\n        var chObj = getChObj(id);\n        /* if channel exists */\n        if (null != chObj && null != val[id]) {\n          var unit = \"\"; //getChUnit(id,\"\");\n          if (\"b_state_of_charge_clean\" == id) {\n            unit = \"%\";\n          }\n          /* if max is 5e-324 then that means we don't have data for that channel, which is not an error, it just means the inverter doesn't have a feature that others might have */\n          if (val[id].max != -1.7976931348623157e308) {\n            var prec = chObj.precision;\n\n            if (create) {\n              $(\"#\" + tableID).append(\n                '<tr id=\"hour_' +\n                  id +\n                  '\">' +\n                  '<th class=\"right\">' +\n                  title +\n                  \"</th>\" +\n                  \"<td>\" +\n                  val[id].min.toFixed(prec) +\n                  unit +\n                  \"</td>\" +\n                  \"<td>\" +\n                  val[id].max.toFixed(prec) +\n                  unit +\n                  \"</td>\" +\n                  \"<td>\" +\n                  val[id].avg.toFixed(prec) +\n                  unit +\n                  \"</td></tr>\"\n              );\n            } else {\n              $(\"#hour_\" + id).html(\n                '<th class=\"right\">' +\n                  title +\n                  \"</th>\" +\n                  \"<td>\" +\n                  val[id].min.toFixed(prec) +\n                  unit +\n                  \"</td>\" +\n                  \"<td>\" +\n                  val[id].max.toFixed(prec) +\n                  unit +\n                  \"</td>\" +\n                  \"<td>\" +\n                  val[id].avg.toFixed(prec) +\n                  unit +\n                  \"</td>\"\n              );\n            }\n          }\n        }\n      }\n\n      /* loads the history json to create the 24 hour data as well as the striplines */\n      function loadHistory() {\n        $(\"#loadingContainer\").show();\n        $(\"#loadingMsg\").html(\"Loading...\");\n\n        var xhr = new XMLHttpRequest();\n        xhr.onreadystatechange = function () {\n          if (xhr.readyState === XMLHttpRequest.DONE) {\n            if (xhr.status === 200) {\n              dataS = $.parseJSON(xhr.responseText);\n\n              processHist(dataS);\n            } else {\n              console.error(\"Error:\", xhr.status);\n              noResponse = true;\n              customFaults(null);\n            }\n          }\n        };\n        xhr.open(\"GET\", \"/history.json\", true);\n        xhr.send();\n      }\n\n      /* processes the history json into 24 hour data and arrays for the striplines */\n      function processHist(hist) {\n        if (0 == hist.recent.length) {\n          setTimeout(loadHistory, 10000);\n          return;\n        }\n\n        var color_green;\n        var color_yellow = \"#f7a11a\";\n        var color_red;\n\n        var d = new Date();\n        var n = d.getTime();\n\n        var oldestTime;\n        var mostRecentTime;\n\n        var count = 0;\n\n        var hourChannels = [];\n\n        /* iterate through the history object array */\n\n        var histAr = hist.recent;\n        //$. each (hist.history, function (packet, entry) {\n        $(\"#loadingMsg\").html(\"Loading BMK charts...\");\n        for (var i = 0; i < histAr.length; i++) {\n          /* add data to the flot chart arrays */\n          if (null != histAr[i].data.b_state_of_charge)\n            data.b_state_array.push([\n              histAr[i].time,\n              histAr[i].data.b_state_of_charge,\n            ]);\n          if (null != histAr[i].data.b_dc_watts)\n            data.b_watts.push([histAr[i].time, histAr[i].data.b_dc_watts]);\n          if (null != histAr[i].data.b_amph_in_out)\n            data.amp_in_out.push([\n              histAr[i].time,\n              histAr[i].data.b_amph_in_out,\n            ]);\n          if (null != histAr[i].data.calc_add_power)\n            data.calc.push([histAr[i].time, histAr[i].data.calc_add_power]);\n        }\n\n        loadDataCreate();\n      }\n\n      /* plots the graphs */\n      function plotGraphs() {\n        $(\"#loadingContainer\").hide();\n\n        /* take data from the json and put it in an array suitable for flot */\n        if (0 != data.b_state_array.length) {\n          var dataArray = data.b_state_array;\n\n          dataArray = tenMinuteAverages(dataArray);\n\n          for (var i = 0; i < dataArray.length; i++) {\n            battArray[i] = [i, dataArray[i]];\n          }\n          while (battArray.length <= 144) {\n            battArray.push([-battArray.length, 0]);\n          }\n\n          /* options for flot */\n          var optionsEditSpark = {\n            series: {\n              shadowSize: 0,\n            },\n            grid: {\n              borderWidth: 0,\n              show: true,\n              hoverable: true,\n              autoHighlight: false,\n            },\n            xaxis: {\n              ticks: 0,\n              tickLength: 0,\n            },\n            yaxis: {\n              max: 100,\n              min: 0,\n              ticks: 2,\n              tickLength: 0,\n            },\n          };\n          /* data for flot */\n          var data2 = [\n            {\n              data: battArray,\n              bars: {\n                show: true,\n                lineWidth: 0,\n                barWidth: 0.5,\n                align: \"left\",\n                fill: 1,\n              },\n              color: \"#808080\",\n              threshold: [\n                {\n                  below: 101,\n                  color: \"#008000\",\n                },\n              ],\n            },\n          ];\n          /* plot the flot chart */\n          $.plot(\"#chargeChart\", data2, optionsEditSpark);\n        }\n\n        /* take data from the json and put it in an array suitable for flot */\n        if (0 != data.b_watts.length) {\n          dataArray = data.b_watts;\n          dataArray = tenMinuteAverages(dataArray);\n          for (var i = 0; i < dataArray.length; i++) {\n            voltsArray[i] = [i, dataArray[i]];\n          }\n          while (voltsArray.length <= 144) {\n            voltsArray.push([-voltsArray.length, 0]);\n          }\n          /* plot the flot chart */\n          $.plot(\n            \"#voltsChart\",\n            [\n              {\n                data: voltsArray,\n                bars: {\n                  show: true,\n                  lineWidth: 0,\n                  barWidth: 0.5,\n                  align: \"left\",\n                  fill: 1,\n                },\n                color: \"#000000\",\n                threshold: [\n                  {\n                    below: 0,\n                    color: \"#f04040\",\n                  },\n                ],\n              },\n            ],\n            {\n              grid: {\n                borderWidth: 0,\n                hoverable: true,\n                autoHighlight: false,\n              },\n              xaxis: {\n                tickLength: 0,\n                ticks: 0,\n              },\n              yaxis: {\n                tickLength: 0,\n                ticks: 3,\n              },\n            }\n          );\n        }\n        /* take data from the json and put it in an array suitable for flot */\n        if (0 != data.amp_in_out.length) {\n          dataArray = data.amp_in_out;\n          dataArray = tenMinuteAverages(dataArray);\n          for (var i = 0; i < dataArray.length; i++) {\n            ampArray[i] = [i, dataArray[i]];\n          }\n          while (ampArray.length <= 144) {\n            ampArray.push([-ampArray.length, 0]);\n          }\n          /* plot the flot chart */\n          $.plot(\n            \"#ampChart\",\n            [\n              {\n                data: ampArray,\n                bars: {\n                  show: true,\n                  lineWidth: 0,\n                  barWidth: 0.5,\n                  align: \"left\",\n                  fill: 1,\n                },\n                color: \"#000000\",\n                threshold: [\n                  {\n                    below: 0,\n                    color: \"#f04040\",\n                  },\n                  {\n                    below: 0,\n                    color: \"#f7a11a\",\n                  },\n                ],\n              },\n            ],\n            {\n              grid: {\n                borderWidth: 0,\n                hoverable: true,\n                autoHighlight: false,\n              },\n              xaxis: {\n                tickLength: 0,\n                ticks: 0,\n              },\n              yaxis: {\n                tickLength: 0,\n                ticks: 3,\n              },\n            }\n          );\n        }\n        if (0 != data.calc.length) {\n          dataArray = data.calc;\n          dataArray = tenMinuteAverages(dataArray);\n          for (var i = 0; i < dataArray.length; i++) {\n            calcArray[i] = [i, dataArray[i]];\n          }\n          while (calcArray.length <= 144) {\n            calcArray.push([-calcArray.length, 0]);\n          }\n\n          /* plot the flot chart */\n          /*$.plot(\"#calcChart\", [{\n      \t\t\t\tdata: calcArray,\n      \t\t\t\tbars: {\n      \t\t\t\t\tshow: true,\n      \t\t\t\t\tlineWidth:0,\n      \t\t\t\t\tbarWidth: .5,\n      \t\t\t\t\talign: \"left\",\n      \t\t\t\t\tfill: 1\n      \t\t\t\t},\n      \t\t\t\tcolor: '#000000',\n      \t\t\t\tthreshold: [{\n      \t\t\t\t\tbelow: 0,\n      \t\t\t\t\tcolor: '#f04040'\n      \t\t\t\t}, {\n      \t\t\t\t\tbelow: 0,\n      \t\t\t\t\tcolor: '#f7a11a'\n      \t\t\t\t}]\n      \t\t\t}], {\n      \t\t\t\tgrid: {\n      \t\t\t\t\tborderWidth: 0,\n      \t\t\t\t\thoverable: true,\n      \t\t\t\t\tautoHighlight: false\n      \t\t\t\t},\n      \t\t\t\txaxis: {\n      \t\t\t\t\ttickLength: 0,\n      \t\t\t\t\tticks:0\n      \t\t\t\t},\n      \t\t\t\tyaxis: {\n      \t\t\t\t\ttickLength: 0,\n      \t\t\t\t\tticks: 3\n      \t\t\t\t}\n      \t\t});*/\n        }\n      }\n\n      /* find the ten minute averages for flot charts */\n      function tenMinuteAverages(notAvgArray) {\n        var avgArray = [];\n        var j = 0;\n        var i = 0;\n        avgArray[j] = 0;\n        var timeDiff = 600000; // ten minutes to milliseconds\n        var count = 0;\n\n        /* get first timestamp */\n\n        if (notAvgArray) var startTime = notAvgArray[0][0];\n\n        /* initialize array */\n        avgArray[0] = 0;\n\n        /* iterate through notAvgArray and take the average of every 60 */\n        for (i = 0; i < notAvgArray.length; i++) {\n          /* if packet time is more than ten minutes difference to the the startTime */\n          if (notAvgArray[i][0] > startTime + timeDiff) {\n            /* if count is not zero, we find the average */\n            if (0 != count) {\n              avgArray[j] /= count;\n              count = 0;\n              j++;\n              avgArray[j] = 0;\n              startTime += timeDiff;\n            } else {\n              /* if count IS 0, then we have no data for that ten minutes and we just put a zero */\n              j++;\n              avgArray[j] = 0;\n              startTime += timeDiff;\n            }\n          }\n          /* add value and increment count */\n          avgArray[j] += parseFloat(notAvgArray[i][1]);\n          count++;\n        }\n        /* get last average */\n\n        avgArray[j] /= count;\n\n        /* return averaged array */\n        return avgArray;\n      }\n\n      /* this is the timer that keeps the page updating. */\n      function timerTick() {\n        da = new Date();\n\n        /* increment seconds */\n        seconds++;\n\n        /* update the timer on the bottom of the screen and the timer at the top of the table */\n        $(\"#age\").html(commaSeparateNumber(seconds));\n        $(\"#ageRep\").html(commaSeparateNumber(seconds));\n\n        /* This will check the server for new data every ten seconds. note that it checks when seconds mod 10 equals 1. This is because when seconds%10==0 was used\n      \t\tit would tend to miss getting new data almost everytime. */\n        if (seconds % 10 == 1 && seconds != 1) {\n          loadData();\n        }\n        /* here, if there was no new data, it checks seconds%10==5, giving it 5 extra seconds and checking the server again. This was added to fix a problem where sometimes\n      \t\tseconds would miss an update, keep going until twice the update time, then update twice in a row. This is double checking if the data is actually\n      \t\told or if it checked too early */\n        if (seconds > 10 && seconds % 10 == 5) {\n          loadData();\n        }\n\n        updateHeadline();\n\n        setTimeout(timerTick, 1000);\n      }\n\n      /* separates a number with commas if over 1,000 */\n      function commaSeparateNumber(val) {\n        if (null != val) {\n          while (/(\\d+)(\\d{3})/.test(val.toString())) {\n            val = val.toString().replace(/(\\d+)(\\d{3})/, \"$1\" + \",\" + \"$2\");\n          }\n        }\n        return val;\n      }\n\n      /* hides div with the id of warning */\n      function hideWarn() {\n        $(\"#connection_warn\").hide();\n      }\n\n      function getUTCTime(val) {\n        var now = new Date(val);\n        var now_utc = new Date(\n          now.getUTCFullYear(),\n          now.getUTCMonth(),\n          now.getUTCDate(),\n          now.getUTCHours(),\n          now.getUTCMinutes(),\n          now.getUTCSeconds()\n        );\n        return now_utc.toString(\"yyyy-MM-dd HH:mm:ss\");\n      }\n\n      function toggleMemPos() {\n        if (\"-210px\" == $(\"#memoryData\").css(\"bottom\")) {\n          MemUp();\n        } else {\n          MemDown();\n        }\n      }\n\n      function MemUp() {\n        $(\"#memoryData\").animate({ bottom: \"50px\" }, \"fast\");\n      }\n\n      function MemDown() {\n        $(\"#memoryData\").animate({ bottom: \"-210px\" }, \"fast\");\n      }\n\n      function toggleAlarmPos() {\n        if (\"-260px\" == $(\"#alarmControl\").css(\"bottom\")) {\n          alarmUp();\n        } else {\n          alarmDown();\n        }\n      }\n      function alarmUp() {\n        $(\"#alarmControl\").animate({ bottom: \"50px\" }, \"fast\");\n      }\n\n      function alarmDown() {\n        $(\"#alarmControl\").animate({ bottom: \"-260px\" }, \"fast\");\n      }\n\n      $(document).ready(function () {\n        /* The bar doesn't work well on ipods  */\n        if (navigator.platform == \"iPhone\" || navigator.platform == \"iPod\") {\n          $(\"#bar\").hide();\n        }\n\n        $.ajaxSetup({ cache: false });\n\n        /* this will shoot off a request to the server when the window is refocused */\n        $(window).focus(function () {\n          //loadData();\n        });\n        /* ajax error listener */\n        $(document).ajaxError(function (event) {\n          //$(\"#connection_warn\").show();\n          $(\"#connection_warn\").append(event);\n          noResponse = true;\n          customFaults(null);\n        });\n        /* request data and start timer */\n        //loadData();\n        loadHeadline();\n        loadChannelData();\n      });\n    </script>\n\n    <div\n      id=\"bar\"\n      style=\"\n        width: 100%;\n        position: fixed;\n        bottom: 0;\n        left: 0;\n        z-index: 2;\n        background: #e0e0e0;\n        text-align: center;\n      \"\n    >\n      <span id=\"bottomar\" style=\"margin-left: 10px; float: left\"\n        >Data from approximately <span id=\"age\">Loading...</span> seconds\n        ago</span\n      >\n    </div>\n\n    <div style=\"text-align: center\" id=\"loadingContainer\">\n      <h1 id=\"loadingMsg\"></h1>\n    </div>\n\n    <div\n      id=\"alarm\"\n      style=\"\n        text-align: center;\n        font-size: 1.5em;\n        padding: 5px;\n        margin-left: 75px;\n        margin-right: 75px;\n        font-weight: bold;\n        display: none;\n      \"\n    >\n      <p id=\"alarmMessage\">The inverter has faulted!</p>\n    </div>\n    <div\n      id=\"connection_warn\"\n      style=\"\n        text-align: center;\n        width: 800px;\n        margin-right: auto;\n        margin-left: auto;\n        background-color: orange;\n        color: white;\n        display: none;\n      \"\n      onclick=\"hideWarn()\"\n    >\n      <h1>\n        No Response From Server. Please check to make sure you are still\n        connected to the internet\n      </h1>\n    </div>\n\n    <div\n      id=\"notConnected\"\n      style=\"\n        text-align: center;\n        width: 800px;\n        margin-right: auto;\n        margin-left: auto;\n        color: white;\n        display: none;\n      \"\n    >\n      <h1>MagWeb Online But Not Connected To Inverter System</h1>\n    </div>\n\n    <div id=\"memoryData\" onclick=\"toggleMemPos()\">\n      <div>\n        <span\n          id=\"memWarn\"\n          style=\"\n            color: white;\n            text-align: center;\n            font-size: 1.5em;\n            display: none;\n          \"\n          ><img\n            src=\"res/images/Exclamation.64.png\"\n            alt=\"Exclamation\"\n          /><br />Memory Low</span\n        >\n        <h3 style=\"color: #ffffff; padding-bottom: 10px\">\n          Memory<br /><span style=\"font-size: 0.75em\">click to show/hide</span>\n        </h3>\n      </div>\n\n      <table id=\"memTable\">\n        <tr style=\"display: none\" class=\"usbRow\">\n          <td colspan=\"2\" style=\"text-align: center\" id=\"usbMsg\">\n            External Storage is inserted\n          </td>\n        </tr>\n        <tr style=\"display: none\">\n          <td></td>\n          <td></td>\n        </tr>\n        <tr>\n          <th style=\"background-color: #303030\" colspan=\"2\">System Memory</th>\n        </tr>\n      </table>\n    </div>\n\n    <div\n      id=\"tables\"\n      style=\"display: table; margin-left: auto; margin-right: auto; width: 70%\"\n    >\n      <div style=\"width: 50%; display: table-cell\">\n        <table\n          id=\"currentTable\"\n          style=\"width: 95%; margin-left: auto; margin-right: auto\"\n        ></table>\n      </div>\n\n      <div style=\"width: 50%; display: table-cell\">\n        <table\n          id=\"hourTable\"\n          style=\"width: 95%; margin-left: auto; margin-right: auto\"\n        ></table>\n      </div>\n    </div>\n    <div style=\"clear: both\">\n      <div id=\"sound_element\"></div>\n    </div>\n    <span id=\"preloadedImages\"></span>\n\n    <br />\n    <br />\n    <div style=\"text-align: center; padding-bottom: 50px\">\n      <h5 style=\"color: #666\">\n        &copy; 2015. All rights reserved.<br /><br />\n        <em\n          >Powered by an\n          <a target=\"_blank\" href=\"http://www.aprsworld.com/\">APRS World</a>\n          solution.</em\n        >\n      </h5>\n    </div>\n  </body>\n</html>\n";

#endif // INDEX_HTML_H
